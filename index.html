<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#313131">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Minecraft Matika - MOBILE FIX</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.17.1/items/diamond_pickaxe.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body { 
            font-family: 'Press Start 2P', cursive; 
            text-align: center; 
            background-color: #313131; 
            background-image: url('https://www.transparenttextures.com/patterns/pixel-weave.png');
            color: white; 
            padding: 10px 5px; /* Minimální polstrování po stranách */
            margin: 0;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .karta { 
            background: #484848; 
            padding: 15px; /* Menší padding pro mobil */
            border: 4px solid #000;
            display: inline-block; 
            box-shadow: 6px 6px 0px #212121;
            width: 92%; /* Karta zabere 92% šířky displeje */
            max-width: 450px; /* Maximální šířka pro tablety/PC */
            box-sizing: border-box; /* Započítá border do šířky */
            position: relative; 
            transition: all 0.5s ease;
            margin-top: 5px;
        }

        /* Speciální úrovně zůstávají, jen mírně upravené stíny pro mobil */
        .boss-level { border-color: #5555ff !important; box-shadow: 0 0 20px #5555ff; }
        .megaboss-level { border-color: #ffaa00 !important; box-shadow: 0 0 25px #ffaa00; }
        .ultraboss-level { border-color: #ff0000 !important; box-shadow: 0 0 30px #ff0000; }
        .nether-level { border-color: #ff4500 !important; background: #2b0a0a; }
        .end-level { border-color: #ff00ff !important; background: #1a001a; }

        h1 { font-size: 16px; margin: 10px 0; }

        .stats-row { 
            display: flex; 
            justify-content: space-between; 
            background: #212121; 
            padding: 5px; 
            margin-bottom: 8px; 
            border: 2px solid #000; 
            font-size: 7px; 
        }

        .xp-bar-container { width: 100%; height: 10px; background: #000; border: 2px solid #555; margin-bottom: 10px; }
        #xp-bar { width: 0%; height: 100%; background: #3cf03c; transition: width 0.4s; }

        #zivoty { 
            color: #ff0000; 
            font-size: 11px; /* Zmenšená srdíčka aby se vešla na řádek */
            margin-bottom: 10px; 
            letter-spacing: -1px;
        }

        #priklad { 
            font-size: 28px; /* Zmenšené písmo příkladu */
            margin: 15px 0; 
            text-shadow: 3px 3px 0px #000; 
        }

        input { 
            font-family: 'Press Start 2P', cursive; 
            font-size: 20px; 
            width: 100px; 
            text-align: center; 
            background: #313131; 
            color: #3cf03c; 
            border: 3px solid #000; 
            padding: 10px; 
            outline: none; 
        }
        
        button.potvrdit { 
            font-family: 'Press Start 2P', cursive; 
            font-size: 9px; 
            padding: 12px; 
            cursor: pointer; 
            border: 3px solid #000; 
            margin: 10px; 
            color: white; 
            background: #5555ff; 
            width: 80%; /* Velké tlačítko pro palec */
        }

        #odmena { 
            margin-top: 10px; 
            padding: 10px; 
            border: 3px solid #3cf03c; 
        }
        #obrazekOdmeny { width: 60px; image-rendering: pixelated; }
        #textOdmeny { font-size: 8px; }

        /* Pojistka pro extra malé mobily */
        @media (max-width: 350px) {
            #priklad { font-size: 22px; }
            #zivoty { font-size: 9px; }
            h1 { font-size: 14px; }
        }
    </style>
</head>
<body>

    <div id="hlavniKarta" class="karta">
        <h1>MATIKA ⛏️</h1>
        
        <div id="zivoty">❤️❤️❤️❤️❤️❤️❤️❤️❤️❤️❤️❤️</div>

        <div class="stats-row">
            <div>LVL: <span id="lvl-cislo">1</span></div>
            <div id="boss-info">BOSS ZA: <span id="boss-za">4</span></div>
        </div>

        <div class="xp-bar-container"><div id="xp-bar"></div></div>

        <div id="priklad">...</div>
        <input type="number" id="odpoved" pattern="\d*" inputmode="numeric">
        <br>
        <button class="potvrdit" onclick="zkontrolovat()">POTVRDIT</button>
        
        <div id="odmena">
            <h2 id="odmena-nadpis" style="font-size: 8px; color: #3cf03c; margin: 5px 0;">LEVEL UP!</h2>
            <img id="obrazekOdmeny" src="" alt="Odměna">
            <div id="textOdmeny" style="color: #5555ff; margin-top: 5px;"></div>
        </div>
    </div>

    <script>
        let vysledek, hvezdy = 0, level = 1, zivoty = 12, posledniZadani = "";
        const hlaskySpravne = ["Kritikl hit!", "Máš XP!", "Profík!", "Diamanty!", "Dane, jseš borec!"];
        const minecraftOdmeny = [
            { jméno: "DIAMANT", url: "https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.17.1/items/diamond.png" },
            { jméno: "MEČ", url: "https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.17.1/items/diamond_sword.png" },
            { jméno: "ZLATÉ JABLKO", url: "https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.17.1/items/golden_apple.png" }
        ];

        function mluv(text, boss = false) {
            window.speechSynthesis.cancel();
            const v = new SpeechSynthesisUtterance(text);
            v.lang = 'cs-CZ'; v.pitch = boss ? 2.0 : 1.8; v.rate = 1.3;
            window.speechSynthesis.speak(v);
        }

        function novyPriklad() {
            document.getElementById('odmena').style.display = 'none';
            const vstup = document.getElementById('odpoved');
            vstup.value = ""; vstup.className = "";
            // Na mobilu automaticky neostříme (focus), aby nevyskakovala klávesnice dřív než chceme

            let nz = ""; let nv = 0;
            do {
                if (Math.random() > 0.5) {
                    let c1 = Math.floor(Math.random() * 8) + 2;
                    let c2 = Math.floor(Math.random() * 8) + 2;
                    nv = c1 * c2; nz = `${c1} x ${c2}`;
                } else {
                    let c1 = Math.floor(Math.random() * 30) + 10;
                    let c2 = Math.floor(Math.random() * 20) + 5;
                    nv = c1 + c2; nz = `${c1} + ${c2}`;
                }
            } while (nz === posledniZadani);
            posledniZadani = nz; vysledek = nv;
            document.getElementById('priklad').innerText = nz;
        }

        function zkontrolovat() {
            const odpoved = parseInt(document.getElementById('odpoved').value);
            if (isNaN(odpoved)) return;

            if (odpoved === vysledek) {
                hvezdy++;
                document.getElementById('xp-bar').style.width = (hvezdy * 20) + "%";
                if (hvezdy >= 5) { novyPriklad(); levelUp(); }
                else {
                    document.getElementById('odpoved').className = "spravne";
                    mluv(hlaskySpravne[Math.floor(Math.random() * hlaskySpravne.length)]);
                    setTimeout(novyPriklad, 800);
                }
            } else {
                zivoty--;
                document.getElementById('zivoty').innerText = "❤️".repeat(zivoty);
                document.getElementById('odpoved').className = "spatne";
                if (zivoty <= 0) {
                    mluv("Gejm ouvr. Tvoje těžba skončila!");
                    alert("GAME OVER! Level: " + level);
                    location.reload();
                } else {
                    mluv("Pozor, Krípr!");
                }
            }
        }

        function levelUp() {
            level++; hvezdy = 0;
            document.getElementById('lvl-cislo').innerText = level;
            document.getElementById('xp-bar').style.width = "0%";
            document.getElementById('boss-za').innerText = 5 - (level % 5 == 0 ? 5 : level % 5);
            ukazOdmenu();
        }

        function ukazOdmenu() {
            const vyber = minecraftOdmeny[Math.floor(Math.random() * minecraftOdmeny.length)];
            const div = document.getElementById('odmena');
            const karta = document.getElementById('hlavniKarta');
            div.style.display = 'block';
            document.getElementById('obrazekOdmeny').src = vyber.url;
            document.getElementById('textOdmeny').innerText = vyber.jméno;
            
            karta.classList.remove('boss-level', 'megaboss-level', 'ultraboss-level', 'nether-level', 'end-level');
            if (level % 25 == 0) { karta.classList.add('end-level'); mluv("End levl ap!", true); }
            else if (level % 10 == 0) { karta.classList.add('megaboss-level'); mluv("Mega bos levl ap!", true); }
            else if (level % 5 == 0) { karta.classList.add('boss-level'); mluv("Bos levl ap!", true); }
            else { mluv("Levl ap!"); }
        }

        novyPriklad();
    </script>
</body>
</html>
